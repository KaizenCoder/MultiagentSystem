# Agent MAINTENANCE 06 ‚Äì Correcteur Logique M√©tier

## 1. Identification

- **Nom :** Correcteur Logique M√©tier NextGeneration
- **Identifiant :** `agent_MAINTENANCE_06_correcteur_logique_metier`
- **Version :** 7.1.0 (Logging Uniforme + Audit Universel)
- **Responsable Principal :** √âquipe de Maintenance NextGeneration
- **Contact Technique :** `#canal-maintenance-ia`

## 2. Mission et Capacit√©s
### 2.1 Mission Principale
Agent sp√©cialis√© dans la correction et la validation de la logique m√©tier avec capacit√©s d'audit universel :
- Validation des patterns m√©tier sur fichiers individuels ou projets complets
- Correction des erreurs de logique
- V√©rification de la coh√©rence des r√®gles m√©tier
- Test des patterns business
- Optimisation du code m√©tier

**üöÄ NOUVEAUT√â V7.1 (Travaux claudecode) :** Int√©gration compl√®te du syst√®me de logging uniforme + capacit√© d'audit universel de la logique m√©tier √©tendue pour analyser des **projets Python complets** (r√©pertoires entiers) en plus des fichiers individuels.

### üîß Syst√®me de Logging Uniforme V7.1
```python
# ‚úÖ MIGRATION SYST√àME LOGGING UNIFI√â (claudecode)
try:
    from core.manager import LoggingManager
    logging_manager = LoggingManager()
    self.logger = logging_manager.get_logger(
        config_name="maintenance",
        custom_config={
            "logger_name": f"nextgen.maintenance.correcteur_logique_metier.{self.id}",
            "log_dir": "logs/maintenance/correcteur",
            "metadata": {
                "agent_type": "MAINTENANCE_06_correcteur_logique_metier",
                "agent_role": "correcteur_logique_metier",
                "system": "nextgeneration"
            }
        }
    )
except ImportError:
    # Fallback en cas d'indisponibilit√© du LoggingManager
    self.logger = logging.getLogger(self.__class__.__name__)
```

### 2.2 Capacit√©s Techniques

#### Capacit√©s d'Audit Universel (V7.0)
- **Audit de fichiers individuels** : Analyse et correction de la logique m√©tier d'un fichier Python sp√©cifique
- **üÜï Audit de r√©pertoires complets** : Analyse r√©cursive de la logique m√©tier de structures de projets enti√®res
- **Filtrage intelligent** : Exclusion automatique des r√©pertoires non pertinents (.venv, __pycache__, .git, etc.)
- **Rapports consolid√©s** : M√©triques de qualit√© logique globales + d√©tails par fichier
- **Scoring unifi√©** : Syst√®me de notation de qualit√© logique coh√©rent (0-100)

#### Capacit√©s d'Analyse Logique
- Analyse AST du code Python
- Validation des patterns m√©tier
- D√©tection des anti-patterns
- Tests de validation des r√®gles m√©tier
- Int√©gration avec le Pattern Factory
- G√©n√©ration de rapports d√©taill√©s

## 3. Architecture V7.0 (Mission Claudecode)

### 3.1 Architecture Technique
- **Orchestrateur Central** : `audit_universal_logique` coordonne tous les types d'audit
- **Audit Fichier Unique** : `_audit_single_python_file` pour l'analyse d√©taill√©e de la logique m√©tier
- **Filtrage Intelligent** : `_should_skip_path` pour ignorer les r√©pertoires non pertinents
- **Mapping Qualit√©** : `_map_score_to_logic_health` pour la notation uniforme
- **Gestion Consolid√©e** : Centralisation des m√©triques et scoring dans l'orchestrateur

### 3.2 M√©triques de Qualit√© Logique
```python
logic_metrics = {
    'pattern_compliance': {'weight': 0.3, 'threshold': {'warning': 70, 'critical': 50}},
    'semantic_correctness': {'weight': 0.3, 'threshold': {'warning': 75, 'critical': 60}},
    'anti_pattern_absence': {'weight': 0.2, 'threshold': {'warning': 80, 'critical': 65}},
    'business_rule_compliance': {'weight': 0.2, 'threshold': {'warning': 85, 'critical': 70}}
}
```

## 4. Guide d'Utilisation

### 4.1 Initialisation
```python
from agents.agent_MAINTENANCE_06_correcteur_logique_metier import AgentMAINTENANCE06CorrecteurLogiqueMetier
agent = AgentMAINTENANCE06CorrecteurLogiqueMetier()
await agent.startup()
```

### 4.2 Audit d'un Fichier Individuel
```python
# Audit de la logique m√©tier d'un fichier Python sp√©cifique
task_details = {
    "action": "audit_universal_logique",
    "params": {
        "target_path": "chemin/vers/votre/fichier.py"
    }
}
result = await agent.execute_task(task_details)
print(f"Score qualit√© logique : {result['data']['score_global']}/100")
print(f"√âtat de la logique m√©tier : {result['data']['etat_logique']}")
```

### 4.3 üÜï Audit d'un Projet Complet (V7.0)
```python
# Audit de la logique m√©tier d'un r√©pertoire complet
task_details = {
    "action": "audit_universal_logique",
    "params": {
        "target_path": "chemin/vers/votre/projet/"
    }
}
result = await agent.execute_task(task_details)

# R√©sultats consolid√©s
print(f"Nombre de fichiers analys√©s : {result['data']['nb_fichiers_analyses']}")
print(f"Score global de qualit√© logique : {result['data']['score_global']}/100")
print(f"√âtat global de la logique m√©tier : {result['data']['etat_logique']}")

# D√©tails par fichier
for fichier_result in result['data']['resultats_fichiers']:
    print(f"- {fichier_result['fichier']} :")
    print(f"  Score : {fichier_result['score']}/100")
    print(f"  Probl√®mes logiques : {len(fichier_result['logic_issues'])}")
```

## 5. Sp√©cifications Techniques V7.0

### 5.1 M√©thodes Principales
- **`audit_universal_logique(target_path)`** : Orchestrateur principal (fichier ou r√©pertoire)
- **`_audit_single_python_file(file_path)`** : Audit d√©taill√© de la logique d'un fichier
- **`_should_skip_path(path)`** : Filtrage intelligent des chemins √† ignorer
- **`_map_score_to_logic_health(score)`** : Mapping score ‚Üí √©tat de la logique

### 5.2 Filtrage Intelligent
R√©pertoires automatiquement ignor√©s :
- `.venv/`, `venv/`, `env/` (environnements virtuels)
- `__pycache__/`, `.pyc` (cache Python)
- `.git/`, `.svn/` (contr√¥le de version)
- `node_modules/`, `.npm/` (d√©pendances JS)
- `build/`, `dist/`, `.egg-info/` (artefacts de build)

### 5.3 M√©triques de Qualit√© Logique
- **Score global** : Note consolid√©e 0-100
- **Nombre de fichiers** : Fichiers Python analys√©s
- **Probl√®mes logiques** : Issues d√©tect√©es par type
- **Patterns m√©tier** : Conformit√© aux patterns
- **Anti-patterns** : Violations d√©tect√©es
- **R√®gles business** : Respect des r√®gles m√©tier

## 6. Utilisation
### 6.1 Initialisation
```python
agent = AgentMAINTENANCE06CorrecteurLogiqueMetier()
await agent.startup()
```

### 6.2 Types de T√¢ches Support√©es
- `validate_business_patterns`: Validation des patterns m√©tier
- `correct_logic`: Correction de la logique
- `test_patterns`: Test des patterns impl√©ment√©s

### 6.3 Exemple d'Utilisation
```python
task = Task(
    id="test_patterns",
    type="validate_business_patterns",
    params={"code": problematic_code}
)
result = await agent.execute_task(task)
```

## 7. Maintenance et √âvolution
### 7.1 Journal des Modifications
- **v6.1.0** : Harmonisation avec les standards Pattern Factory NextGeneration
- **v6.0.0** : Refonte majeure avec support AST et patterns m√©tier
- **v5.0.0** : Ajout de la validation des patterns

### 7.2 D√©pendances
- Python 3.9+
- `core.agent_factory_architecture`
- Modules standards Python (ast, sys, typing)

### 7.3 Tests
Tests disponibles dans `tests/business_logic/`

## 8. Int√©gration
### 8.1 Configuration
Configuration via `maintenance_config.json` :
```json
{
    "agent_type": "business_logic_corrector",
    "version": "6.1.0",
    "status": "enabled"
}
```

### 8.2 Logging
Utilise le syst√®me de logging centralis√© de l'√©quipe de maintenance.

## 9. Support et Contact
- Canal Slack : `#canal-maintenance-ia`
- Documentation : `/docs/business-logic/`
- Wiki : `wiki/agents/business-logic-corrector`

## 10. Description G√©n√©rale

üîß Agent sp√©cialis√© dans la correction et validation de la logique m√©tier Python, d√©tection d'incoh√©rences s√©mantiques et application de patterns m√©tier robustes pour garantir la qualit√© architecturale et la coh√©rence du code.

Cet agent utilise des techniques avanc√©es d'analyse AST, de pattern matching et de validation s√©mantique pour identifier et corriger les probl√®mes de logique m√©tier.

## 11. Objectifs et Missions

- **Correction Logique M√©tier :** D√©tection et correction automatique d'erreurs logiques courantes
- **Validation Patterns :** V√©rification conformit√© aux patterns m√©tier (Factory, Strategy, Observer)
- **Analyse S√©mantique :** D√©tection d'incoh√©rences s√©mantiques et probl√®mes de design
- **Anti-Pattern Detection :** Identification et correction d'anti-patterns (God Class, Magic Numbers)
- **Support √âquipe Maintenance :** Audit conformit√© m√©tier avec scoring et recommandations

## 12. Fonctionnalit√©s Cl√©s (Conformit√© Pattern Factory)

L'agent respecte le Pattern Factory NextGeneration et expose les m√©thodes suivantes :

- **`startup()`** : Initialise l'agent correcteur logique m√©tier
- **`health_check()`** : V√©rifie l'√©tat de sant√©. Retourne `{"status": "healthy"}` en fonctionnement normal
- **`execute_task(task: Task)`** : Point d'entr√©e principal pour correction et validation logique
  - **Action `correct_business_logic`** :
    - **`task.params` attendus** :
      - `code` (str) : Code source Python √† analyser et corriger
      - `file_path` (str, optionnel) : Chemin fichier pour contexte
    - **R√©sultat** : Analyse des probl√®mes, corrections et code corrig√©
  - **Action `validate_business_patterns`** :
    - **`task.params` attendus** :
      - `code` (str) : Code source √† analyser pour patterns m√©tier
    - **R√©sultat** : Patterns trouv√©s, manquants et recommandations
  - **Action `detect_logic_inconsistencies`** :
    - **`task.params` attendus** :
      - `code` (str) : Code source √† analyser pour incoh√©rences
    - **R√©sultat** : Liste incoh√©rences avec classification par s√©v√©rit√©
  - **Action `audit_business_compliance`** :
    - **`task.params` attendus** :
      - `code` (str) : Code source √† auditer
      - `rules` (list, optionnel) : R√®gles m√©tier sp√©cifiques
    - **R√©sultat** : Score conformit√©, violations et recommandations
- **`shutdown()`** : Arr√™te l'agent proprement

### Capacit√©s Sp√©cialis√©es

```python
get_capabilities() -> [
    "correct_business_logic",
    "validate_business_patterns",
    "detect_logic_inconsistencies", 
    "analyze_semantic_correctness",
    "fix_anti_patterns",
    "validate_api_design",
    "check_error_handling",
    "verify_null_safety",
    "audit_business_compliance",
    "generate_logic_improvements"
]
```

## 13. Technologies Avanc√©es

### Analyse AST S√©mantique
- **Parsing avanc√©** pour d√©tection patterns et anti-patterns
- **Validation architecturale** avec d√©tection violations design
- **Metrics automatiques** (longueur m√©thodes, complexit√©, imbrication)

```python
# Analyse patterns m√©tier
business_patterns = {
    "factory_pattern": ["create_", "build_", "make_"],
    "validation_pattern": ["validate_", "check_", "verify_"],
    "error_handling": ["try:", "except", "raise"],
    "null_safety": ["if not", "is None", "assert"]
}
```

### Structure LogicIssue
```python
@dataclass
class LogicIssue:
    severity: str           # CRITICAL, HIGH, MEDIUM, LOW
    issue_type: str         # logic_error, semantic_issue, pattern_violation
    description: str        # Description du probl√®me
    line_number: Optional[int] = None
    suggestion: Optional[str] = None
    code_snippet: Optional[str] = None
```

### D√©tection Anti-Patterns
```python
# Anti-patterns √† √©viter
anti_patterns = {
    "god_class": "Classes avec trop de responsabilit√©s",
    "magic_numbers": "Nombres magiques sans constantes", 
    "deep_nesting": "Imbrication trop profonde",
    "long_methods": "M√©thodes trop longues (>50 lignes)"
}
```

## 14. Workflow de Correction Logique

```
1. üìã R√©ception code source via execute_task
2. üîç Analyse AST pour d√©tection patterns et violations
3. üìä Classification probl√®mes par s√©v√©rit√© (CRITICAL‚ÜíLOW)
4. üîß G√©n√©ration corrections automatiques si possible
5. üìù Cr√©ation suggestions d'am√©lioration architecture
6. üìÑ Retour rapport structur√© avec code corrig√©
```

## 15. Exemples d'Utilisation

### Correction de Logique M√©tier

```python
from core.agent_factory_architecture import Task
from agents.agent_MAINTENANCE_06_correcteur_logique_metier import create_agent_MAINTENANCE_06_correcteur_logique_metier

# Code avec probl√®mes logiques
problematic_code = '''
def process_data(data):
    result = data * 42  # Nombre magique
    return result

class DataProcessor:  # Pas de docstring
    def __init__(self):
        pass
        
    def long_method(self, x, y, z, a, b, c, d, e, f, g):  # Trop de param√®tres
        if x > 0:
            if y > 0:
                if z > 0:  # Imbrication profonde
                    if a > 0:
                        return x + y + z + a
        return 0  # Pas de gestion d'erreurs
'''

# Cr√©ation de l'agent
correcteur = create_agent_MAINTENANCE_06_correcteur_logique_metier()
await correcteur.startup()

# Correction logique m√©tier
task = Task(
    type="correct_business_logic",
    params={
        "code": problematic_code,
        "file_path": "business_logic.py"
    }
)

result = await correcteur.execute_task(task)
if result.success:
    print(f"üîß Probl√®mes d√©tect√©s: {result.data['issues_detected']}")
    for issue in result.data['issues']:
        print(f"  ‚Ä¢ {issue['severity']}: {issue['description']} (L{issue['line']})")
        print(f"    Suggestion: {issue['suggestion']}")
```

### Validation de Patterns M√©tier

```python
# Code √† analyser pour patterns
business_code = '''
class UserFactory:
    @staticmethod
    def create_user(email, name):
        user = User(email, name)
        user.validate_email()
        return user

class User:
    def __init__(self, email, name):
        self.email = email
        self.name = name
    
    def validate_email(self):
        if "@" not in self.email:
            raise ValueError("Email invalide")
'''

# Validation patterns
task = Task(
    type="validate_business_patterns",
    params={"code": business_code}
)

result = await correcteur.execute_task(task)
if result.success:
    data = result.data
    print(f"üìã Patterns trouv√©s: {data['patterns_found']}")
    print(f"üìã Patterns manquants: {data['missing_patterns']}")
    for rec in data['recommendations']:
        print(f"üí° {rec}")
```

### Audit de Conformit√© M√©tier

```python
# Audit avec r√®gles sp√©cifiques
task = Task(
    type="audit_business_compliance",
    params={
        "code": business_code,
        "rules": [
            "functions_must_have_docstrings",
            "classes_must_have_docstrings", 
            "error_handling_required",
            "no_magic_numbers"
        ]
    }
)

result = await correcteur.execute_task(task)
if result.success:
    audit_data = result.data
    print(f"üìä Score conformit√©: {audit_data['compliance_score']}/100")
    print(f"‚ö†Ô∏è Violations: {len(audit_data['violations'])}")
    for violation in audit_data['violations']:
        print(f"  ‚Ä¢ {violation}")
```

### D√©tection d'Incoh√©rences Logiques

```python
# Code avec incoh√©rences
inconsistent_code = '''
import unused_module
from datetime import datetime

def calculate_age(birth_date):
    # Variable cr√©√©e mais jamais utilis√©e
    current_year = 2025
    age = 2025 - birth_date.year  # Ann√©e cod√©e en dur
    return age
'''

task = Task(
    type="detect_logic_inconsistencies",
    params={"code": inconsistent_code}
)

result = await correcteur.execute_task(task)
if result.success:
    data = result.data
    print(f"üîç Incoh√©rences: {data['inconsistencies_count']}")
    severity_breakdown = data['severity_breakdown']
    for severity, count in severity_breakdown.items():
        if count > 0:
            print(f"  {severity}: {count}")
```

## 16. Format de R√©sultat

### Correction de Logique M√©tier

```json
{
  "success": true,
  "data": {
    "issues_detected": 4,
    "issues": [
      {
        "type": "pattern_violation",
        "severity": "LOW",
        "description": "Nombre magique d√©tect√©: 42",
        "line": 2,
        "suggestion": "Remplacer par une constante nomm√©e"
      },
      {
        "type": "pattern_violation", 
        "severity": "MEDIUM",
        "description": "M√©thode 'long_method' trop longue (15 statements)",
        "line": 8,
        "suggestion": "Diviser en m√©thodes plus petites pour am√©liorer la lisibilit√©"
      },
      {
        "type": "logic_error",
        "severity": "HIGH", 
        "description": "M√©thode 'long_method' sans gestion d'erreurs",
        "line": 8,
        "suggestion": "Ajouter try/except pour la robustesse"
      }
    ],
    "corrections": {
      "code": "# Code corrig√© avec am√©liorations...",
      "corrections_applied": [],
      "corrections_count": 0
    },
    "corrected_code": "# Code avec corrections appliqu√©es"
  }
}
```

### Validation de Patterns

```json
{
  "success": true,
  "data": {
    "patterns_found": ["factory_pattern", "validation_pattern"],
    "missing_patterns": ["error_handling", "null_safety"],
    "recommendations": [
      "Consid√©rer l'impl√©mentation du pattern error_handling",
      "Consid√©rer l'impl√©mentation du pattern null_safety"
    ]
  }
}
```

### Audit de Conformit√©

```json
{
  "success": true,
  "data": {
    "compliance_score": 70,
    "violations": [
      "Fonction 'process_data' sans docstring (ligne 1)",
      "Classe 'DataProcessor' sans docstring (ligne 5)"
    ],
    "recommendations": [
      "Ajouter des docstrings pour am√©liorer la documentation",
      "Impl√©menter une gestion d'erreurs robuste"
    ],
    "rules_checked": [
      "functions_must_have_docstrings",
      "classes_must_have_docstrings",
      "error_handling_required",
      "no_magic_numbers"
    ]
  }
}
```

## 17. Capacit√©s d'Analyse Avanc√©es

### D√©tection M√©thodes Longues
```python
# Analyse des m√©thodes et fonctions
for node in ast.walk(tree):
    if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef)):
        if len(node.body) > 20:  # Seuil configurable
            issues.append(LogicIssue(
                severity="MEDIUM",
                issue_type="pattern_violation",
                description=f"M√©thode '{node.name}' trop longue",
                suggestion="Diviser en m√©thodes plus petites"
            ))
```

### Validation Gestion d'Erreurs
```python
# V√©rification gestion d'erreurs
has_error_handling = any(
    isinstance(n, ast.Try) for n in ast.walk(node)
)
if not has_error_handling and len(node.body) > 5:
    issues.append(LogicIssue(
        severity="HIGH",
        issue_type="logic_error",
        description=f"M√©thode '{node.name}' sans gestion d'erreurs",
        suggestion="Ajouter try/except pour la robustesse"
    ))
```

### D√©tection Nombres Magiques
```python
# D√©tection de nombres magiques
elif isinstance(node, ast.Num) and isinstance(node.n, (int, float)):
    if node.n not in [0, 1, -1]:  # Exceptions communes
        issues.append(LogicIssue(
            severity="LOW", 
            issue_type="pattern_violation",
            description=f"Nombre magique d√©tect√©: {node.n}",
            suggestion="Remplacer par une constante nomm√©e"
        ))
```

## 18. D√©pendances

- **Python 3.7+**
- **core.agent_factory_architecture** (Agent, Task, Result)
- **Modules standard** : ast, inspect, re, logging, asyncio, dataclasses
- **Typing** : Annotations et structures typ√©es pour classification

## 19. Journal des Modifications (Changelog)

- **v6.1.0 (2025-06-26)** :
  - Harmonisation avec standards Pattern Factory NextGeneration
  - Enrichissement docstrings classe avec description d√©taill√©e capacit√©s logique m√©tier
  - Extension `get_capabilities()` : 1 ‚Üí 10 capacit√©s sp√©cialis√©es
  - Impl√©mentation compl√®te analyse AST, patterns m√©tier et anti-patterns
  - Ajout dataclass LogicIssue pour classification structur√©e
  - Documentation .md compl√®tement refaite avec exemples techniques
- **Versions ant√©rieures** : Structure basique sans fonctionnalit√©s avanc√©es

## 20. Tests et Validation

### Test Int√©gr√©

L'agent inclut un test principal complet :

```python
# Test avec code probl√©matique volontaire
problematic_code = '''
def process_data(data):
    result = data * 42  # Nombre magique
    return result

class DataProcessor:  # Pas de docstring
    def __init__(self):
        pass
        
    def long_method(self, x, y, z, a, b, c, d, e, f, g):  # Trop de param√®tres
        if x > 0:
            if y > 0:
                if z > 0:  # Imbrication profonde
                    if a > 0:
                        return x + y + z + a
        return 0  # Pas de gestion d'erreurs
'''

# Tests correction, patterns, conformit√©
await agent.execute_task(correction_task)
await agent.execute_task(patterns_task)
await agent.execute_task(compliance_task)
```

### Ex√©cution des Tests

```bash
# Test direct de l'agent
python agents/agent_MAINTENANCE_06_correcteur_logique_metier.py

# Output attendu :
# üöÄ D√©marrage des tests...
# üè• Health Check: {'status': 'healthy'}
# üõ†Ô∏è Capabilities: ['correct_business_logic', 'validate_business_patterns', ...]
# üîß Test correction logique: Probl√®mes d√©tect√©s: 4
# üéØ Test validation patterns: Patterns trouv√©s/manquants
```

## 21. Cas d'Usage Recommand√©s

- **Code Review** : Validation automatique logique m√©tier dans PRs
- **Refactoring** : D√©tection anti-patterns avant refactorisation
- **Quality Gates** : Audit conformit√© avant d√©ploiement  
- **Technical Debt** : Identification probl√®mes de design systematiques
- **Architecture Validation** : V√©rification respect patterns m√©tier

## 22. Statut et Validation

- ‚úÖ **Pattern Factory** : Conforme (Agent, Task, Result)
- ‚úÖ **M√©thodes async** : startup, shutdown, execute_task, health_check
- ‚úÖ **Capabilities** : 10 capacit√©s sp√©cialis√©es d√©finies
- ‚úÖ **Technologies** : AST analysis, pattern matching, dataclasses
- ‚úÖ **Documentation** : Docstrings enrichies et .md synchronis√©
- ‚úÖ **Tests Int√©gr√©s** : Validation compl√®te avec code probl√©matique
- ‚úÖ **Logique M√©tier** : Analyse s√©mantique et correction automatique

**Agent MAINTENANCE 06 - √âtat : PR√äT POUR VALIDATION**